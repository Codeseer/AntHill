// Generated by CoffeeScript 1.3.3
(function() {
  var ObjectId, Project, Schema, User, mongoose;

  mongoose = require('mongoose');

  Schema = mongoose.Schema;

  ObjectId = Schema.ObjectId;

  Project = require('./project').Model;

  User = new Schema({
    username: {
      type: String,
      unique: true,
      required: true
    },
    password: String,
    project_ids: [ObjectId]
  });

  User.methods.validPassword = function(password, done) {
    if (this.password === password) {
      return done(null, this);
    } else {
      return done(null, false, {
        message: 'Invalid Password'
      });
    }
  };

  User.methods.getProjects = function(cb) {
    return Project.findOne({
      _id: {
        $in: this.project_ids
      }
    }).exec(function(err, projects) {
      if (err) {
        return cb(err);
      } else {
        return cb(null, projects);
      }
    });
  };

  exports.Model = mongoose.model('user', User);

  exports.Schema = User;

}).call(this);
